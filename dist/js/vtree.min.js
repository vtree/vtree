"undefined"==typeof Vtree&&(Vtree={}),"undefined"==typeof console&&(console={log:function(){}}),function(a){Vtree=function(){var b=[];return{plugins:{defaults:{core:{}}},addPlugin:function(b,c){var d=this,e=Vtree.plugins[b]||Vtree.plugins.defaults[b];if(!e)throw"plugin not existing: "+b;var f=e[c];if(f){var g=a.extend(!0,{},f.defaults);a.extend(this,g),a.each(f._fn,function(b,c){if(d.pluginFns[b]){var e=d.pluginFns[b][d.pluginFns[b].length-1],f=function(){var b,d=Array.prototype.slice.call(arguments);return b=c.apply(a.extend({},this,{_call_prev:function(){return e.apply(this,d)}}),d)};d.pluginFns[b].push(f),d[b]=function(){var a,c=Array.prototype.slice.call(arguments),e=d.pluginFns[b];return a=e[e.length-1].apply(this,c)}}else d.pluginFns[b]=[c],d[b]=c})}},init:function(b,c){var d=this;this.pluginFns={};for(var e in Vtree.plugins.defaults)Vtree.addPlugin.apply(this,[e,c]);b.plugins&&a.each(b.plugins,function(a,b){Vtree.addPlugin.apply(d,[b,c])})},create:function(a){for(var c=!1,d=0,e=b.length;e>d;d++){var f=b[d];a.container.is(f.container)&&(c=!0,this.destroy(f))}var g=new Vtree.Tree(a);return b.push(g),g},destroy:function(a){for(var c=this.getTree(a),d=0,e=b.length;e>d;d++){var f=b[d];if(c.id===f.id)break}b.splice(d,1),c.destroy()},getTree:function(c){var d,e=!1;if(c instanceof Vtree.Tree)d=c,e=!0;else for(var f=0,g=b.length;g>f;f++)if(d=b[f],d.id==c||d.container.is(c)||d.container.is(a(c))){e=!0;break}if(!e)throw"tree not found: "+c;return d},getTrees:function(){return b},_generateTreeId:function(){var a=function(){return(0|65536*(1+Math.random())).toString(16).substring(1)};return a()+a()+a()}}}()}(jQuery),function(a){Vtree.Tree=function(b){return Vtree.init.apply(this,[b,"tree"]),a.extend(this,b),this.build()},Vtree.plugins.defaults.core.tree={defaults:{id:"",initiallyOpen:[],initiallyLoadedNodes:[],nodeStore:null,container:a("body"),dataSource:{},asynchronous:!1},_fn:{build:function(){if(this.setId(),!this.container.length)throw"container is empty. Check that the element is on the page or that you run your code when the document is ready.";return this.getInitiallyLoadedNodes(),this.container.trigger("beforeInit.tree",[this]),this.asynchronous||this.continueBuilding(),this},continueBuilding:function(){this.nodeStore=new Vtree.NodeStore({tree:this,plugins:this.plugins}),this.refresh(),this._attachEvents(),this.container.trigger("onReady.tree",[this])},reset:function(){this.destroy(),this.build()},setId:function(){this.id||(this.id=this.dataSource.tree&&"undefined"!=typeof this.dataSource.tree.id?this.dataSource.tree.id.replace(/\s+/g,"_"):Vtree._generateTreeId())},getInitiallyLoadedNodes:function(){var a=this,b=function(c){for(var d=0;d<c.length;d++)node=c[d],node.hasChildren?node.hasChildren&&node.nodes&&node.nodes.length>0&&(a.initiallyLoadedNodes.push(node.id),b(node.nodes)):a.initiallyLoadedNodes.push(node.id)};this.dataSource&&this.dataSource.tree&&this.dataSource.tree.nodes&&b(this.dataSource.tree.nodes)},refresh:function(){this.container.empty().append(this._generateHTML()).trigger("rendered.tree",[this])},_attachEvents:function(){var b=this,c=function(c){var d=a(c.target),e=d.is("li")?d:d.parents("li").eq(0),f=b.getNode(e.attr("data-nodeid"));b.container.trigger(c.type+".node",[b,f,c]),c.stopPropagation()};return this.container.delegate("li","click",c).delegate("li","dblclick",c).delegate("li","hover",c).delegate("li","contextmenu",function(a){try{c(a)}catch(a){}}).delegate(".openClose","click",function(c){var d=b.getNode(a(this).parent().attr("data-nodeid"));d.toggleOpen(),c.stopPropagation()}),this.container},_generateHTML:function(){var b=a("<ul>").addClass("tree");tree=this.nodeStore.getStructure();for(var c=0,d=tree.children.length;d>c;c++)b.append(tree.children[c].getHTML());return b},getNode:function(a){return this.nodeStore.getNode(a)},destroy:function(){this.container.unbind(".node").unbind(".tree").undelegate().empty()},toJson:function(){return this.nodeStore.toJson()},getSiblings:function(a){return this.nodeStore.getSiblings(a)},getParent:function(a){return this.nodeStore.getParent(a)},getParents:function(a){return this.nodeStore.getParents(a)},getChildren:function(a){return this.nodeStore.getChildren(a)}}}}(jQuery),function(a){Vtree.NodeStore=function(b){if(Vtree.init.apply(this,[b,"nodeStore"]),this.rootNode=new Vtree.Node({isRoot:!0,id:"root",title:"root",description:"root",icon:"",hasChildren:!0,parent:null,parents:[],children:[],isOpen:!0,tree:b.tree,plugins:b.tree.plugins}),this.structure={id2NodeMap:{},tree:{}},a.extend(!0,this,b),!this.initStructure(b))throw"internal structure not initialised properly"},Vtree.plugins.defaults.core.nodeStore={defaults:{tree:null},_fn:{initStructure:function(){var a=this.getDataSource();if("undefined"!=typeof a){this.structure;var b=a.nodes||a.children;this._recBuildNodes(null,[],b),this.structure.tree=this.rootNode}return!0},getDataSource:function(){return this.dataSource||(this.dataSource=this.tree.dataSource.tree),this.dataSource},_recBuildNodes:function(b,c,d){for(var e=[],f=!1,g=0,h=d.length;h>g;g++){var i=d[g],j="undefined"!=typeof i.isOpen?i.isOpen:!1,k="undefined"!=typeof i.hasVisibleChildren?i.hasVisibleChildren:!1,l="undefined"!=typeof i.hasRenderedChildren?i.hasRenderedChildren:!1;if(i.id.replace(" ","_"),-1!==a.inArray(i.id,this.tree.initiallyOpen)&&(j=!0,k=!0,l=!0,!f)){for(var m=0,n=c.length;n>m;m++)c[m].isOpen=!0,c[m].hasVisibleChildren=!0,c[m].hasRenderedChildren=!0;f=!0}this.tree.nodeStore=this;var o=a.extend({},i,{id:i.id.replace(" ","_"),parent:b,parents:c,children:[],isOpen:j,hasRenderedChildren:l,hasVisibleChildren:k,tree:this.tree,nodeStore:this,plugins:this.tree.plugins});o.nodes&&delete o.nodes;var p=new Vtree.Node(o);this.structure.id2NodeMap[i.id]=p,e.push(p);var q=i.nodes||i.children;q&&q.length&&this._recBuildNodes(p,c.concat(p),q)}b?b.children=e:this.rootNode.children=e},getStructure:function(){return this.structure.tree},toJson:function(){return this.structure.tree.toJson()},getNode:function(a){var b;if(a instanceof Vtree.Node)b=a;else{if("undefined"==typeof this.structure.id2NodeMap[a])throw"node not found: "+a;b=this.structure.id2NodeMap[a]}return b},getSiblings:function(a){for(var b=this.getNode(a),c=b.parent?b.parent.children:this.rootNode.children,d=c.length-1;d>=0;d--)c[d].id==b.id&&c.splice(d,1);return c},getParent:function(a){return this.getNode(a).parent},getParents:function(a){return this.getNode(a).parents},getChildren:function(a){return this.getNode(a).children}}}}(jQuery),function(a){Vtree.Node=function(b){Vtree.init.apply(this,[b,"node"]),a.extend(this,b)},Vtree.plugins.defaults.core.node={defaults:{id:0,el:null,tree:null,isOpen:!1,title:"",description:"",customClass:"",hasVisibleChildren:!1,hasRenderedChildren:!1,hasChildren:!1,parent:null,parents:[],children:[],iconClass:"",iconPath:{open:"",close:""},customHTML:""},_fn:{open:function(){if(this.hasChildren&&!this.hasVisibleChildren){this.tree.container.trigger("beforeOpen.node",[this.tree,this]),this.toggleLoading();var a=this.getEl().addClass("open");this.iconPath.open&&(a.find("img")[0].src=this.iconPath.open),this.tree.asynchronous||this.continueOpening()}return this},continueOpening:function(){return this.isOpen=!0,this.hasChildren&&!this.hasRenderedChildren&&(this.getEl().append(this._getChildrenHTML()),this.hasRenderedChildren=!0),this.hasVisibleChildren=!0,this.toggleLoading(),this.tree.container.trigger("afterOpen.node",[this.tree,this]),this},close:function(){if(this.hasChildren&&this.hasVisibleChildren){this.tree.container.trigger("beforeClose.node",[this.tree,this]),this.isOpen=!1,this.hasVisibleChildren=!1;var a=this.getEl().removeClass("open");this.iconPath.close&&(a.find("img")[0].src=this.iconPath.close),this.tree.container.trigger("afterClose.node",[this.tree,this])}return this},toggleOpen:function(){return this.isOpen?this.close():this.open()},_getChildrenHTML:function(){for(var b=a("<ul>").addClass("children"),c=this.children,d=0,e=c.length;e>d;d++)b.append(c[d].getHTML());return b},getHTML:function(){var b=this.isOpen?" open ":"";b+=this.hasChildren?" folder":"",b+=" "+this.customClass;var c=-1!==this.customClass.indexOf("title")?"h3":"em",d=a("<li><a></a></li>").attr("data-nodeid",this.id).attr("data-treeid",this.tree.id).attr("id",this.tree.id+"_"+this.id).addClass(b),e=d.children("a").addClass("title").attr("title",this.description);this.href&&e.attr("href",this.href);var f=!("string"!=typeof this.iconPath||""===this.iconPath),g=!("undefined"==typeof this.iconPath||!this.iconPath.close||!this.iconPath.open),h=g||f;if(this.iconClass)e.append("<i></i><"+c+"></"+c+">").find("i").addClass(this.iconClass).end().find(c).text(this.title);else if(h){var i;i=this.hasChildren&&"undefined"!=typeof this.iconPath.close&&"undefined"!=typeof this.iconPath.open?this.isOpen?this.iconPath.open:this.iconPath.close:this.iconPath,e.append("<i><img/></i><"+c+"></"+c+">").find("img").attr("src",i).end().find(c).text(this.title)}else-1!==this.customClass.indexOf("title")?e.append("<"+c+"></"+c+">").children().html(this.title):e.html(this.title);return this.customHTML&&d.append("<div class='custom'>").children(".custom").append(this.customHTML),this.hasChildren?(d.prepend("<a class='openClose'/>"),this.isOpen&&d.append(this._getChildrenHTML())):d.prepend("<a href='#' class='align'></a>"),d},toggleLoading:function(){var a=this.getEl(),b=a.hasClass("loading")?this.title:"Loading...",c=a.toggleClass("loading").children("a.title, label"),d=c.find("h3, em").length?c.find("h3, em"):c.children("span");d.length?d.text(b):c.text(b)},getEl:function(){return this.el=a("li#"+this.tree.id+"_"+this.id),this.el},toJson:function(){var a=jQuery.extend(!0,{},this);for(var b in a)"function"==typeof a[b]&&delete a[b];if(delete a.tree,delete a.parents,delete a.el,delete a.parent,delete a.nodeStore,delete a.pluginFns,delete a.plugins,a.children.length)for(var c=0,d=a.children.length;d>c;c++)a.children[c]=a.children[c].toJson;return a},recursivityOnChildren:function(a){if(this.hasChildren)for(var b=0,c=this.children,d=this.children.length;d>b;b++){var e=c[b];"function"==typeof a&&(a(e),e.hasChildren&&e.recursivityOnChildren(a))}},recursivityOnParents:function(a){for(var b=0,c=this.parents,d=this.parents.length;d>b;b++){var e=c[b];"function"==typeof a&&e&&a(e)}}}}}(jQuery),function(a){Vtree.plugins.ajax_loading={tree:{defaults:{ajaxUrl:"",ajaxParameters:{},asynchronous:!0,forceAjaxReload:!1},_fn:{build:function(){var b=this;return this.container.on("beforeOpen.node",function(c,d,e){if(!e.hasChildren||e.children.length&&!b.forceAjaxReload)e.continueOpening();else{var f=a.extend(!0,{action:"getChildren",nodes:e.id},d.ajaxParameters);a.ajax({type:"GET",url:b.ajaxUrl,dataType:"json",data:f,success:a.proxy(e.onAjaxResponse,e)})}}).on("afterClose.node",function(a,c,d){b.forceAjaxReload&&(d.getEl().children("ul.children").remove(),d.hasRenderedChildren=!1)}).on("OpenNodesFromCookie.tree",function(a,b){b.fetchChildren(b.initiallyOpen)}).on("beforeInit.tree",function(b,c){-1==a.inArray("cookie",c.plugins)&&c.fetchChildren(c.initiallyOpen)}),this._call_prev()},fetchChildren:function(b){var c=this;if(b=jQuery.grep(b,function(b){var d=!0;try{var e=c.getNode(b);e&&e.children.length&&(d=!1)}catch(f){-1!==a.inArray(b,c.initiallyLoadedNodes)&&(d=!1)}return d}),b.length){var d=a.extend(!0,{action:"getChildren",nodes:b.join(",")},this.ajaxParameters);a.ajax({type:"GET",url:this.ajaxUrl,dataType:"json",data:d,success:a.proxy(this.onAjaxResponse,this,d)})}else this.continueBuilding()},getAjaxData:function(a){return a},onAjaxResponse:function(a,b){var c,d,e,f,g;for(c=this.getAjaxData(b),d=a.nodes.split(","),e=0;e<d.length;e++)f=d[e],g=c[f],g&&this.addDataToNodeSource(g);this.continueBuilding()},addDataToNodeSource:function(a){if(a.nodes&&a.nodes.length)for(var b=0;b<a.nodes.length;b++){var c=a.nodes[b],d=c.nodes;d&&d.constructor==Array&&0===d.length&&delete c.nodes}if(a.id)try{var e=this.getNode(a.id);this.nodeStore._recBuildNodes(e,e.parents.concat(e),a.nodes)}catch(f){var g=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];e.id===b?e.nodes=c:e.hasChildren&&e.nodes&&e.nodes.length>0&&g(e.nodes,b,c)}};this.dataSource&&this.dataSource.tree&&this.dataSource.tree.nodes&&g(this.dataSource.tree.nodes,a.id,a.nodes)}}}},node:{_fn:{onAjaxResponse:function(a){var b=this.tree.getAjaxData(a);if("undefined"==typeof b[this.id])throw"ajax response didn't send back node with id:"+this.id;this.nodeStore._recBuildNodes(this,this.parents.concat(this),b[this.id].nodes),this.continueOpening(),this.tree.container.trigger("afterChildrenLoaded.node",[this.tree,this])}}}}}(jQuery),function(a){Vtree.plugins.checkbox={tree:{defaults:{initiallyChecked:[],disabledCheckboxes:[],checkBehaviour:"checkParents",uncheckBehaviour:"uncheckChildren",displayCheckbox:!0,checkedClass:"checked",disableBehaviour:"disableChildren",disabledClass:"disabled"},_fn:{build:function(){var b=this;return this.container.on("afterChildrenLoaded.node",function(c,d,e){for(var f=0;f<e.children.length;f++){var g=e.children[f];-1!==a.inArray(g.id,d.initiallyChecked)&&g.check(!0),"checkChildren"===b.checkBehaviour&&e.isChecked&&g.check(!0),"uncheckChildren"!==b.uncheckBehaviour||e.isChecked||g.uncheck(!0),"disableChildren"===b.disableBehaviour&&e.isDisabled&&g.disable()}}).on("onReady.tree",function(a,b){b.initiateCheckedNodes(),b.initiateDisabledNodes()}),this._call_prev()},initiateCheckedNodes:function(){var a,b,c,d=this.initiallyChecked;for(a=0,len=d.length;len>a;a++){b=d[a];try{c=this.getNode(b)}catch(e){}"undefined"!=typeof c&&c.check(!0)}},initiateDisabledNodes:function(){var a,b,c,d=this.disabledCheckboxes;for(a=0,len=d.length;len>a;a++){b=d[a];try{c=this.getNode(b)}catch(e){}"undefined"!=typeof c&&c.disable(!0)}},_attachEvents:function(){var b=this;return this.displayCheckbox&&this.container.delegate("input[type=checkbox]","click",function(c){var d=b.getNode(a(this).parents("li").attr("data-nodeid"));d.toggleCheck(),c.stopPropagation()}),this.displayCheckbox||this.container.delegate("li","click.node",function(c){var d=b.getNode(a(this).attr("data-nodeid"));d.toggleCheck(),c.stopPropagation()}),this._call_prev()},getCheckedNodes:function(){return this.nodeStore.getCheckedNodes()},_generateHTML:function(){var a=this._call_prev();return this.displayCheckbox||a.addClass("noCheckbox"),a}}},node:{defaults:{isChecked:!1,isDisabled:!1},_fn:{toggleCheck:function(){return this.isChecked?this.uncheck():this.check()},disable:function(){if(this.isDisabled=!0,this.getEl().addClass(this.tree.disabledClass),this.tree.displayCheckbox&&this.getEl().find("input[type=checkbox]").eq(0).prop("disabled","disabled"),"disableParents"===this.tree.disableBehaviour&&this.parent&&this.parent.disable(),"disableChildren"===this.tree.disableBehaviour)for(var a=0;a<this.children.length;a++){var b=this.children[a];b.disable()}},check:function(a){var b="undefined"!=typeof a?a:!1;if(this.isChecked=!0,this.getEl().addClass(this.tree.checkedClass),this.tree.displayCheckbox&&b&&this.getEl().find("input[type=checkbox]").eq(0).prop("checked",!0),"checkParents"===this.tree.checkBehaviour&&this.parent&&this.parent.check(!0),"checkChildren"===this.tree.checkBehaviour)for(var c=0;c<this.children.length;c++)this.children[c].check(!0);this.tree.container.trigger("check.node",[this.tree,this,b])},uncheck:function(a){var b="undefined"!=typeof a?a:!1;if(this.isChecked=!1,this.getEl().removeClass(this.tree.checkedClass),this.tree.displayCheckbox&&b&&this.getEl().find("input[type=checkbox]").eq(0).prop("checked",!1),"uncheckParents"==this.tree.uncheckBehaviour&&this.parent&&this.parent.uncheck(!0),"uncheckChildren"==this.tree.uncheckBehaviour)for(var c=0;c<this.children.length;c++)this.children[c].uncheck(!0);this.tree.container.trigger("uncheck.node",[this.tree,this,a])},getHTML:function(){var b=this._call_prev();return this.isChecked&&b.addClass(this.tree.checkedClass),this.isDisabled&&b.addClass(this.tree.disabledClass),this.tree.displayCheckbox&&(b.children("a.title").replaceWith(function(){return a("<label />").append(a(this).contents())}),b.children("label").wrapInner("<span>").prepend('<input type="checkbox"></input>').find("input").attr("checked",this.isChecked).attr("disabled",this.isDisabled)),b},isOneDescendantChecked:function(){var a=!1;if(!this.children)return a;for(var b=0;b<this.children.length;b++){var c=this.children[b];if(c.isChecked){a=!0;break}if(a=c.isOneDescendantChecked())break}return a}}},nodeStore:{_fn:{getCheckedNodes:function(){var a,b,c,d=this;return a=function(b){for(var c=[],d=0,e=b.length;e>d;d++)node=b[d],node.isChecked&&c.push(node),node.hasChildren&&(c=c.concat(a(node.children)));return c},b=a(this.structure.tree.children),c=jQuery.map(jQuery.grep(this.tree.initiallyChecked,function(a){var b=!1;try{d.getNode(a)}catch(c){b=!0}return b}),function(a){return{id:a,loaded:!1,initiallyChecked:!0}}),b.concat(c)}}}}}(jQuery),function(a){Vtree.setCookie=function(a,b,c){var d=new Date,e=new Date;(null===c||0===c)&&(c=1),e.setTime(d.getTime()+864e5*c),document.cookie=a+"="+escape(b)+";expires="+e.toGMTString()},Vtree.readCookie=function(a){var b=" "+document.cookie,c=b.indexOf(" "+a+"=");if(-1==c&&(c=b.indexOf(";"+a+"=")),-1===c||""===a)return"";var d=b.indexOf(";",c+1);return-1==d&&(d=b.length),unescape(b.substring(c+a.length+2,d))},Vtree.plugins.cookie={tree:{_fn:{build:function(){return this.container.on("beforeInit.tree",function(a,b){var c,d=Vtree.readCookie("Vtree");if(d){c=JSON.parse(d);var e=c.trees[b.id];e?(b.initiallyOpen=e.opened||[],b.initiallyChecked=e.checked||[]):(c.trees[b.id]={opened:b.initiallyOpen||[],checked:b.initiallyChecked||[]},Vtree.setCookie("Vtree",JSON.stringify(c),7))}else c={trees:{}},c.trees[b.id]={opened:b.initiallyOpen||[],checked:b.initiallyChecked||[]},Vtree.setCookie("Vtree",JSON.stringify(c),7);b.container.trigger("OpenNodesFromCookie.tree",[b])}).bind("afterOpen.node",function(b,c,d){var e=JSON.parse(Vtree.readCookie("Vtree")),f=e.trees[c.id];-1==a.inArray(d.id,f.opened)&&f.opened.push(d.id),Vtree.setCookie("Vtree",JSON.stringify(e),7)}).bind("beforeClose.node",function(b,c,d){var e=JSON.parse(Vtree.readCookie("Vtree")),f=e.trees[c.id];"function"==typeof d.isOneDescendantChecked&&d.isOneDescendantChecked()||(f.opened=jQuery.grep(f.opened,function(b){var c=function(a){var b=[];if(a.hasChildren&&a.hasVisibleChildren)for(var d=0,e=a.children.length;e>d;d++){var f=a.children[d];f.isOpen&&(b.push(f.id),b=b.concat(c(f)))}return b};return b!=d.id&&-1==a.inArray(b,c(d))}),Vtree.setCookie("Vtree",JSON.stringify(e),7))}).bind("check.node",function(b,c,d){var e=JSON.parse(Vtree.readCookie("Vtree")),f=e.trees[c.id];-1==a.inArray(d.id,f.checked)&&f.checked.push(d.id),Vtree.setCookie("Vtree",JSON.stringify(e),7)}).bind("uncheck.node",function(a,b,c){var d=JSON.parse(Vtree.readCookie("Vtree")),e=d.trees[b.id];e.checked=jQuery.grep(e.checked,function(a){return a!=c.id}),Vtree.setCookie("Vtree",JSON.stringify(d),7)}),this._call_prev()},reset:function(){var a=Vtree.readCookie("Vtree");if(a){VtreeCookie=JSON.parse(a);var b=VtreeCookie.trees[this.id];b&&(VtreeCookie.trees[this.id]={opened:tree.initiallyOpen||[],checked:tree.initiallyChecked||[]},console.log("cookie reset!"),Vtree.setCookie("Vtree",JSON.stringify(VtreeCookie),7))}return this._call_prev()}}}}}(jQuery);